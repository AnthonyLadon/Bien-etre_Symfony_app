{% extends 'base.html.twig' %}

{% block title %}Mon profil{% endblock %}

{% block titreh1 %}
	<h1>Mon profil</h1>
{% endblock %}

{% block searchForm %}
	{% embed "_searchFormToggle.html.twig" %}{% endembed %}
{% endblock %}


{% block body %}
  <article>
      <div class="partenaire-avatar">
      {% if partenaire.images[0] is defined and partenaire.images[0] != '' %}
            <a href=""><img class="prestaire_img" src="{{ asset('images/uploads/' ~ partenaire.images[0]) }}" alt="photo de profil du prestataire"/></a>
      {% else %}
            <a href=""><img class="prestaire_img" src="{{ asset('images/avatars/blank_profile.webp') }}" alt="photo de profil du prestataire"/></a>
      {% endif %}
      <a href="{{path ("addImagePrest", {id: app.user.prestataire.id})}}">Modifier votre photo de profil</a>
      {% if partenaire.nom %}
        <h3>{{partenaire.nom }}</h3>
      {% endif %}
    </div>
    {% if partenaire.promotion is defined %}
      {% for pr in partenaire.promotion %}
        {%  if pr.affichageDe|date("d/m/Y") <= "now"|date("d/m/Y") and pr.affichageJusque|date("d/m/Y") >= "now"|date("d/m/Y") %}
        <div>
          <p><span>Promotion!</span> Dans la cat√©gorie "{{pr.categorieService}}", du: {{pr.debut|date("d/m/Y") }} au: {{pr.fin|date("d/m/Y")}}</p>
          <p>{{ pr.nom }}</p>
          {{ pr.description }}
        </div>
        {% endif %}
      {% endfor %}
    {% endif %}
  
    {% if partenaire.proposer is defined %}
      <div class="prestataire-detail-services">
        <h3 class="prestataire-detail-services-list-title">Mes cat√©gories de service</h3>
        <div class="prestataire-detail-services-list">
          <ul>
            {% for service in partenaire.proposer %}
            <li><a href="{{path('detailService',{id : service.id} )}}">
            {{ service.nom}}
            </a>
            {% endfor %}
          </ul>
        </div>
      </div>
    {% else %}
      <div class="prestataire-detail-services-list">
        <h3 class="prestataire-detail-no-service">Je ne propose pas encore de cat√©gorie de service</h3>
      </div>
    {% endif %}

    <a href="{{path('update_infos_prest',{id: partenaire.id})}}">Mettre mes informations √† jour</a>

    {% if partenaire.stage is not empty %}
    <div class="prestataire-detail-stage">
      <h3 class="prestataire-detail-stage-list-title">Les stages que je propose actuellement</h3>
      <div class="prestataire-detail-stage-list">
        <ul>
            {% for st in partenaire.stage %}
              {# test si le stage est dans sa periode d'affichage. Si oui -> Affichage #}
              {# Le 'if' en dessous ne fonctionne pas !! Je ne comprend pas pourquoi #}
              {# {%  if st.affichageDe|date("d/m/Y") <= "now"|date("d/m/Y") and "now"|date("d/m/Y") <= st.affichageJusque|date("d/m/Y") %} #}
              {%  if st.affichageDe|date("d/m/Y") <= "now"|date("d/m/Y") %}
                <li>
                  <a href="{{path('detailStage',{id : st.id} )}}">{{st.nom}}</a>
                </li>
              {% endif %}
            {% endfor %}
        </ul>
      </div>
    </div>
    {% else %}
      <h3 class="prestataire-detail-no-stage">Je ne propose pas de stage pour le moment</h3>
   {% endif %}

	<a href="{{path('profil_prest_stage',{id: partenaire.id})}}">Ajouter un stage</a>

  <div>
  <h3>Mes promotions</h3>
    {% if partenaire.promotion is not empty %}
      {% for pr in partenaire.promotion %}
        <div>
          <p><span>Promotion!</span> Dans la cat√©gorie "{{pr.categorieService}}", du: {{pr.debut|date("d/m/Y") }} au: {{pr.fin|date("d/m/Y")}}</p>
          <p>{{ pr.nom }}</p>
          {{ pr.description }}
        </div>
      {% endfor %}
    {% else %}
     <p>Je n'ai pas de promotion pour le moment </p>
    {% endif %}
        <a href="{{path('profil_prest_promo',{id: partenaire.id})}}">Ajouter une promotion</a>
  </div>

    <div class="prestataire-detail-contact">
      <p>
        Mon site web:
        {% if partenaire.siteWeb is defined %}
           <a href="#">{{ partenaire.siteWeb }}</a>
        {% endif %}
      </p>
      <p>
        T√©l:
        {{ partenaire.tel }}
      </p>
      <p>
        N¬∞ TVA:
        {{ partenaire.tvaNum }}
      </p>
    </div>
    {# Carrousel photos prestataire #}
        <a href="{{path ("imagesPrest", {id: app.user.prestataire.id})}}">G√©rer les photos de la gallerie</a>
    <div class="gallery">
    {% if partenaire.imagesPhoto is not empty %}
        {% for img in partenaire.imagesPhoto %}
          <img class="prestaire_img" src="{{ asset('images/uploads/' ~ img) }}" alt="photo carrousel"/>
        {% endfor %}
        {% else %}
        <p class="prestataire-detail-no-stage">üò± Oops je ne propose pas encore de photo dans ma gallerie..</p>
    {% endif %}
    </div>
    {% if partenaire.utilisateur.adresseRue is defined and  partenaire.utilisateur.adresseNum is defined and partenaire.utilisateur.codePostal is defined and partenaire.utilisateur.commune is defined%}
          <a href="">Modifier mon adresse</a>
          <p>Pour me trouver: </p>
          <p>{{ partenaire.utilisateur.adresseRue }} {{ partenaire.utilisateur.adresseNum }}</p>
          <p>{{ partenaire.utilisateur.codePostal }} {{ partenaire.utilisateur.commune }}</p>
    {% else %}
          <a href="">Renseigner mon adresse</a>
          <p>Oops, je n'ai pas encore renseign√© mon adresse</p>
    {% endif %}
    <div>

    <div class="prestataire-detail-comments-zone">
       <h3 class="prestataire-detail-comments-title">Commentaires</h3>
      {% for com in partenaire.commentaires %}
        <div class="prestataire-detail-comments">
          <h4>{{com.titre}}</h4>
          <p class="prestataire-detail-comments-content">{{com.contenu}}</p>
          <div class="prestataire-detail-comments-date-author">
            <p>Le {{com.dateEncodage| date('d/m/Y')}}</p>
            <p> par: {{com.internaute }}</p>
          </div>
        </div>
        <div class="prestataire-detail-comments-separator"></div>
      {% endfor %}
    </div>
  </article>
{% endblock %}